---
title: "Rating by Countries"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(ggridges)
library(plotly)
```

```{r, include=FALSE}
tidy_ramen = 
  read_csv("./ramen-ratings.csv") %>% 
  janitor::clean_names() %>% 
  separate(top_ten, into = c("year", "rank"), sep = " #", convert = TRUE) %>% 
  mutate(
    country = str_replace(country, "Hong Kong", "China"),
    country = str_replace(country, "Taiwan", "China"),
    style = factor(style),
    country = factor(country),
    brand = factor(brand),
    stars = as.numeric(stars)
  )
```

<center><img src="pictures/ramen_world.jpg"></center>  

## Background Introduction 
There are `r tidy_ramen %>% distinct(country) %>% summarize(count = n())` countries included in our Ramen dataset, with a total of `r nrow(tidy_ramen)` ramen varieties. 


## Top Ramen Produce Countries
Can you imagine how popular ramen is in these countries?!
```{r, echo=FALSE, message=FALSE}
top10_country = 
  tidy_ramen %>%
  count(country) %>%
  mutate(
    country = fct_reorder(country, n),
    country_rank = min_rank(desc(n))
  ) %>%
  filter(country_rank <= 10) %>% 
  ggplot(aes(x = country, y = n, fill = country)) +
    geom_col() +
    geom_text(
      aes(label = n),
      nudge_y = 10
    ) +
    labs(
      title = "Top 10 ramen produce countries",
      y = "Number of ramen varieties",
      x = "Country"
    ) +
    theme(legend.position = "none", axis.text.x = element_text(angle = 30))

top10_country
```

The top four countries that had the most ramen varieties rated are China (n = 530), Japan (n = 352), USA (n = 323) and South Korea (n = 309), with over 300 varieties of ramen recorded! The count of ramen varieties produced by China far outweighs the ramen varieties in other countries.

### Rating Distribution among Top Four Ramen Produce Countries
Now let's take a closer look at the rating distribution among the top four ramen produce countries!
```{r, echo=FALSE, message=FALSE}
tidy_ramen_top4 = 
  tidy_ramen %>%
  filter(country == c("China", "Japan", "USA", "South Korea")) %>%
  drop_na(stars) %>%
  ggplot(aes(x = stars, y = country, fill = country)) + 
  geom_density_ridges(scale = .85) +
  labs(
    title = "Ramen rating distribution among Japan, USA, and South Korea",
    x = "Stars (0-5)",
    y = "Country"
  )

tidy_ramen_top4
```

According to the graph, it appears that most ramens produced by China, South Korea, and USA have a peak of rating scores around 4 stars and a second but smaller peak at score 5. Among all four countries, Japan has relatively higher rating scores with more rating scores at score around 4 to 5 stars. 



## Top Average Rating Countries
What are the top countries that have the highest average rating scores on their ramens? Do you have any guess?

<center><img src="pictures/question.jpg"></center>

Here is the result!

Let's first take a look at the top 10 countries with the highest average rating scores :)
(NOTE: Check out the average rating score for each country by moving your mouse to each bar)
```{r, echo=FALSE, message=FALSE, warning=FALSE}
tidy_ramen %>%
  group_by(country) %>%
  drop_na(stars) %>%
  summarize(avg_rating = round(mean(stars), 2)) %>%
  arrange(desc(avg_rating)) %>%
  head(10) %>%
  mutate(
    country = fct_reorder(country, avg_rating),
    text_label = str_c("Country: ", country, "\nAverage Stars: ", avg_rating)
  ) %>%
  plot_ly(x = ~country, y = ~avg_rating, color = ~country, type = "bar", text = ~text_label) %>% 
  layout(
    title = "Average stars for each top 10 country",
    xaxis = list(title = "Country"),
    yaxis = list(title = "Average stars")
  )
```

Does the result differ from your expectation? It appears that the top ten average rating countries have average rating scores between the range of 3.5 and 4.5 out of 5 stars. Brazil had the highest average rating score (`r tidy_ramen %>% group_by(country) %>% summarize(avg_rating = round(mean(stars), 2)) %>% filter(country == "Brazil") %>% pull(avg_rating)` out of 5) among all countries, followed by Sarawak (`r tidy_ramen %>% group_by(country) %>% summarize(avg_rating = round(mean(stars), 2)) %>% filter(country == "Sarawak") %>% pull(avg_rating)` out of 5) and Cambodia (`r tidy_ramen %>% group_by(country) %>% summarize(avg_rating = round(mean(stars), 2)) %>% filter(country == "Cambodia") %>% pull(avg_rating)` out of 5). These countries produced ramens with higher quality (better taste) despite that they were not the top ramen producers in varieties.

## Bottom Average Rating Countries

What about the bottom countries that have the lowest average rating scores on their ramens? 

Check out the bottom 10 countries with the lowest average rating scores below!
(NOTE: Check out the average rating score for each country by moving your mouse to each bar)
```{r, echo=FALSE, message=FALSE, warning=FALSE}
tidy_ramen %>%
  group_by(country) %>%
  drop_na(stars) %>%
  summarize(avg_rating = round(mean(stars), 2)) %>%
  arrange(avg_rating) %>%
  head(10) %>%
    mutate(
    country = fct_reorder(country, desc(avg_rating)),
    text_label = str_c("Country: ", country, "\nAverage Stars: ", avg_rating)
  ) %>%
  plot_ly(x = ~country, y = ~avg_rating, color = ~country, type = "bar", text = ~text_label) %>% 
  layout(
    title = "Average stars for each bottom 10 country",
    xaxis = list(title = "Country"),
    yaxis = list(title = "Average stars")
  )
```

Nigeria had the lowest average rating score (`r tidy_ramen %>% group_by(country) %>% summarize(avg_rating = round(mean(stars), 2)) %>% filter(country == "Nigeria") %>% pull(avg_rating)` out of 5) among all countries, followed by Canada (score `r tidy_ramen %>% group_by(country) %>% summarize(avg_rating = round(mean(stars), 2)) %>% filter(country == "Canada") %>% pull(avg_rating)` out of 5) and Netherlands (`r tidy_ramen %>% group_by(country) %>% summarize(avg_rating = round(mean(stars), 2)) %>% filter(country == "Netherlands") %>% pull(avg_rating)` out of 5). The other countries had average rating scores approximate to 3 out of 5.   

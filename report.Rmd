---
title: "Ramen Adventure Report"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE)

theme_set(theme_minimal() + theme(legend.position = "none"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

<style type="text/css"></style>

<center><img src="./pictures/about_ramen.jpg" style="width:75%"></center>
  
## Motivation
All members of the group are noodles lovers and want to look for the best instant noodles to purchase as well as the worst instant noodles to avoid purchasing in the future. We found an amazing dataset about ramen ratings in [Kaggle](https://www.kaggle.com/) and decided to use it as a reference to answer our questions.

&nbsp;

## Related Work?

&nbsp;

## Initial Questions
* Primarily, we just wanted to know what are the best and worst instant noodles according to the dataset.
* After we looked further into the dataset, we thought it would also be interesting if we explore more about:
  * TOP TEN
    - Which country/brand produced the greatest number of top 10 ramens?
    - Which 5 brands produced the most varieties? What are the rating stars distribution of these 5 brands? For these 5 brands, what are their percentage of 5-Stars ramen?
  
  &nbsp;
  
  * BY COUNTRY
    - Which countries produced the most varieties of ramens? What is the ramen rating stars distribution among the top ramen produce countries?
    - What are top 3 countries that have the highest average ramen rating stars recorded in our dataset? What about the bottom 3? 

&nbsp;

## Data
### Data Source and Structure
* The dataset was republished according to [The Ramen Rater](https://www.theramenrater.com/) by Aleksey Bilogur. It can be accessed [here](https://www.kaggle.com/residentmario/ramen-ratings).  
* [The Ramen Rater](https://www.theramenrater.com/) is a website on which Hans Lienesch posted his reviews of instant noodles.  
* Each record in the raw dataset is a single ramen product review:
  * `Review #`: The unique ID for reviews. More recently reviewed ramen varieties have higher numbers. 
  * `Brand`: The brand name of the ramen variety.
  * `Variety`: The product name.
  * `Country`: The country where the ramen variety is from. 
  * `Style`: The package tyle/style of the ramen variety.
  * `Stars` indicates the ramen quality, as assessed by the rater, Hans, on a 5-point scale. 
  * `Top Ten`: The rank and rated year of each top 10 ramen.  

### Data Cleaning

```{r clean data}
tidy_ramen = 
  read_csv("./ramen-ratings.csv") %>% 
  janitor::clean_names() %>% 
  separate(top_ten, into = c("year", "rank"), sep = " #", convert = TRUE) %>% 
  mutate(
    country = str_replace(country, "Hong Kong", "China"),
    country = str_replace(country, "Taiwan", "China"),
    style = factor(style),
    country = factor(country),
    brand = factor(brand),
    stars = as.numeric(stars)
  )
```

We conducted data cleaning on the raw dataset, which included:  

* Separated the variable "top_ten" into two columns (`year` and `rank`).
* Recoded values "Taiwan", "Hong Kong" for `country` as "China" to keep consistency of level with other values.
* Set variables with the appropriate data types.

&nbsp;

## Exploratory Analysis
### Top 10 Ramens by Country/Brand
We generated bar charts of the number of top 10 ramen varieties for each country/brand as below:

```{r}
top_country_bar = 
  tidy_ramen %>% 
  drop_na(rank) %>% 
  count(country) %>% 
  mutate(country = fct_reorder(country, n)) %>% 
  ggplot(aes(x = country, y = n, fill = country)) +
    geom_col() +
    geom_text(
      aes(label = n),
      nudge_y = 0.125
    ) + 
    labs(
      title = "Number of top 10 ramen varieties produced by each country",
      y = "Number of top 10 ramen varieties",
      x = "Country"
    )

top_country_bar
```

```{r}
top_brand_bar = 
  tidy_ramen %>% 
  drop_na(rank) %>% 
  count(brand) %>% 
  mutate(brand = fct_reorder(brand, n)) %>% 
  ggplot(aes(x = brand, y = n, fill = brand)) +
    geom_col() +
    geom_text(
      aes(label = n),
      nudge_y = 0.125
    ) + 
    labs(
      title = "Number of top 10 ramen varieties produced by each brand",
      y = "Number of top 10 ramen varieties",
      x = "Brand"
    ) +
    theme(axis.text.x = element_text(angle = 30))

top_brand_bar
```

Singapore was the country that had the most top 10 ramen varieties (`r tidy_ramen %>% drop_na(rank) %>% filter(country == "Singapore") %>% nrow()`), while Prima Taste was the brand that had the most top 10 ramen varieties (`r tidy_ramen %>% drop_na(rank) %>% filter(brand == "Prima Taste") %>% nrow()`).


### Exploration by Country

In the Rating by Country page, we performed data analysis on the ramen variety count by country to give us an idea about the top ramen produce countries. We created a bar graph of the top 10 ramen produce countries with their counts of ramen varieties labeled on the graph. 
```{r, echo=FALSE, message=FALSE}
top10_country = 
  tidy_ramen %>%
  count(country) %>%
  mutate(
    country = fct_reorder(country, n),
    country_rank = min_rank(desc(n))
  ) %>%
  filter(country_rank <= 10) %>% 
  ggplot(aes(x = country, y = n, fill = country)) +
    geom_col() +
    geom_text(
      aes(label = n),
      nudge_y = 10
    ) +
    labs(
      title = "Top 10 ramen produce countries",
      y = "Number of ramen varieties",
      x = "Country"
    ) +
    theme(axis.text.x = element_text(angle = 30))

top10_country
```

Initially we would love to plot ramen rating stars distribution graph on the top 3 ramen produce countries. However, after checking the bar graph result, we decided to include the top 4 ramen produce countries in the following analysis, since the counts of ramen varieties produced by the 3rd and 4th countries are pretty close. Consequently, we created a violin graph for the rating stars distribution among the top 4 ramen produce countries.
```{r, echo=FALSE, message=FALSE}
top4_violin = 
  tidy_ramen %>%
  filter(country == c("China", "Japan", "USA", "South Korea")) %>%
  drop_na(stars) %>%
  ggplot(aes(x = country, y = stars, fill = country)) + 
  geom_violin() +
  labs(
    title = "Ramen rating distribution among Japan, USA, and South Korea",
    x = "Stars (0-5)",
    y = "Country"
  )

top4_violin
```

Our next step was to calculate the average ramen rating stars for each country in our dataset to find the top three and bottom three countries. But before doing that, we need to check if the number of ramens rated and recorded in our dataset is large enough to present the average ramen rating stars for each country. 

To do this, we ploted a scatter plot of average rating stars vs. count of ramen varieties for each country.
```{r, echo=FALSE, message=FALSE}
num_var_country = 
  tidy_ramen %>% 
  count(country)

avg_country = 
  tidy_ramen %>% 
  group_by(country) %>% 
  summarize(avg = round(mean(stars, na.rm = TRUE), 2))

avg_num_country = 
  num_var_country %>% 
  inner_join(avg_country, by = "country")

scatter_avg_num = 
  avg_num_country %>% 
  ggplot(aes(x = n, y = avg)) +
    geom_point(color = "Orange") +
    labs(
      x = "Number of varieties rated",
      y = "Average stars",
      title = "Average stars vs. Number of varieties rated for countries"
    )

scatter_avg_num
```

After checking the scatter plot, we decided to focus on only countries with 30 or more varieties rated and recorded in our dataset, and created a bar chart for the average ramen rating stars for these countries. 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
avg_country_bar = 
  avg_num_country %>%
  filter(n >= 30) %>% 
  mutate(
    country = fct_reorder(country, avg),
    text_label = str_c("Country: ", country, "\nAverage Stars: ", avg)
  ) %>%
  plot_ly(x = ~country, y = ~avg, color = ~country, type = "bar", text = ~text_label) %>% 
  layout(
    title = "Average stars for each country with 30 or more varieties rated",
    xaxis = list(title = "Country"),
    yaxis = list(title = "Average stars")
  )

avg_country_bar
```

### Exploration by Brand

```{r}
five_stars =
  tidy_ramen %>%
  select(brand, stars) %>%
  group_by(brand) %>%
  filter(stars == 5)

zero_stars =
  tidy_ramen %>%
  select(brand, stars) %>%
  group_by(brand) %>%
  filter(stars == 0)
```

The total number of brands is `r nrow(count(tidy_ramen, brand))`. The number of brands with 5-star ramens is `r nrow(count(five_stars, brand))`, and the number of brands with 0-star ramens is `r nrow(count(zero_stars, brand))`.  

We first drew a bar chart to show the numbers of varieties for the 5 brands with most varieties rated.

```{r}
most_various = 
  tidy_ramen %>%
  group_by(brand) %>%
  summarize(num_varieties = n()) %>%
  top_n(5) %>%
  mutate(brand = fct_reorder(brand, num_varieties))

most_various_plot =
  most_various %>%
  mutate(text_label = str_c("Brand: ", brand, "\nNumber of varieties: ", num_varieties)) %>% 
  plot_ly(
    x = ~brand, y = ~num_varieties, color = ~brand, type = "bar", 
    text = ~text_label,
    marker = list(color = 'viridis', 
                  line = list(color = 'white', width = 1.5))) %>% 
  layout(title = "5 Ramen Brands with Most Rated Varieties",
         xaxis = list(title = "Brand"),
         yaxis = list(title = "Number of Varieties")) 

most_various_plot
```

*Nissin* is the winner with `r tidy_ramen %>% filter(brand == 'Nissin') %>% summarize(count = n())` ramen varieties rated. The second to fifth brands are *Nongshim*, *Maruchan*, *Mama*, and *Paldo*. Each of them has about 60 to 100 ramen varieties rated.  


For these 5 brands, we created a box plot about their rating distributions.

```{r}
distri_various = 
  tidy_ramen %>%
  drop_na(stars) %>%
  filter(brand %in% c("Paldo", "Mama", "Maruchan", "Nongshim", "Nissin")) %>%
  mutate(brand = forcats::fct_relevel(brand, c("Paldo", "Mama", "Maruchan", "Nongshim", "Nissin"))) %>% 
  ggplot(aes(x = brand, y = stars, color = brand)) + 
  geom_boxplot() +
  labs(
    title = "Rating Distribution Plot of the 5 Brands with Most Rated Varieties",
    x = "Brand",
    y = "Rating Stars (0-5)"
  )

distri_various
```

The median rating stars for *Nissin*, *Nongshim*, and *Paldo* are close to 4 stars. The medians for *Mama* and *Maruchan* are lower than 4 stars. More than 75% of products of these 5 brands were rated above or equal to 3 Stars.  

We then created a bar chart showing the percentage of 5-star for each of these 5 brands from the lowest on the left to the highest on the right.
 
```{r}
five_stars_various = 
  tidy_ramen %>%
  drop_na(stars) %>%
  filter(brand %in% c("Paldo", "Mama", "Maruchan", "Nongshim", "Nissin"),
         stars == 5) %>%
  group_by(brand) %>%
  summarize(num_five = n())

num_five_various = 
  full_join(
    most_various, five_stars_various, by = c("brand")
  ) %>%
  mutate(prct = num_five / num_varieties * 100)

prct_plot = 
  num_five_various %>%
  mutate(brand = fct_reorder(brand, prct)) %>% 
  ggplot(aes(x = brand, y = prct, fill = brand)) + 
  geom_col() +
  geom_text(
    aes(label = round(prct, 2)),
    nudge_y = 0.5
  ) +
  labs(
    title = "Percentage of 5 Stars Ramen among the 5 Brands with Most Rated Varieties",
    x = "Brand",
    y = "Percentage of 5 Stars (%)"
  )

prct_plot
```

All of these 5 brands have at least one ramen variety that was rated as 5 stars. *Paldo* has the highest percentage of ramen varieties rated as 5 stars, while *Maruchan* has the lowest percentage of ramen varieties rated as 5 stars.

### Exploration by Type/Style

&nbsp;

## Additional Analysis

&nbsp;

## Discussion



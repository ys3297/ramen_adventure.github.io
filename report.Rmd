---
title: "Ramen Adventure Report"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE)

theme_set(theme_minimal() + theme(legend.position = "none"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

<style type="text/css"></style>

<center><img src="./pictures/about_ramen.jpg" style="width:75%"></center>
  
## Motivation
All members of the group are noodles lovers and want to look for the best instant noodles to purchase as well as the worst instant noodles to avoid purchasing in the future. We found an amazing dataset about ramen ratings in [Kaggle](https://www.kaggle.com/) and decided to use it as a reference to answer our questions.

## Related Work?

## Initial Questions
* Primarily, we just wanted to know what are the best and worst instant noodles according to the dataset.
* After we looked further into the dataset, we thought it would also be interesting if we explore more about:
  * Which country/brand produced the greatest number of top 10 ramens?
  * 
  * Which 5 brands produced the most varieties? What are the rating stars distribution of these 5 brands? For these 5 brands, what are their percentage of 5-Stars ramen?

## Data
### Data Source and Structure
* The dataset was republished according to [The Ramen Rater](https://www.theramenrater.com/) by Aleksey Bilogur. It can be accessed [here](https://www.kaggle.com/residentmario/ramen-ratings).  
* [The Ramen Rater](https://www.theramenrater.com/) is a website on which Hans Lienesch posted his reviews of instant noodles.  
* Each record in the raw dataset is a single ramen product review:
  * `Review #`: The unique ID for reviews. More recently reviewed ramen varieties have higher numbers. 
  * `Brand`: The brand name of the ramen variety.
  * `Variety`: The product name.
  * `Country`: The country where the ramen variety is from. 
  * `Style`: The package tyle/style of the ramen variety.
  * `Stars` indicates the ramen quality, as assessed by the rater, Hans, on a 5-point scale. 
  * `Top Ten`: The rank and rated year of each top 10 ramen.  

### Data Cleaning
```{r clean data}
tidy_ramen = 
  read_csv("./ramen-ratings.csv") %>% 
  janitor::clean_names() %>% 
  separate(top_ten, into = c("year", "rank"), sep = " #", convert = TRUE) %>% 
  mutate(
    country = str_replace(country, "Hong Kong", "China"),
    country = str_replace(country, "Taiwan", "China"),
    style = factor(style),
    country = factor(country),
    brand = factor(brand),
    stars = as.numeric(stars)
  )
```

We conducted data cleaning on the raw dataset, which includes: 
* separating the variable "top_ten" into two columns ("year" and "rank");
* recoding values "Taiwan", "Hong Kong" for `country` as "China" to keep consistency of level with other values;
* setting variables to the appropriate data type.

## Exploratory Analysis
### Top 10 Ramens by Country/Brand
```{r}
top_country_bar = 
  tidy_ramen %>% 
  drop_na(rank) %>% 
  count(country) %>% 
  mutate(country = fct_reorder(country, n)) %>% 
  ggplot(aes(x = country, y = n, fill = country)) +
    geom_col() +
    geom_text(
      aes(label = n),
      nudge_y = 0.125
    ) + 
    labs(
      title = "Number of top 10 ramen varieties produced by each country",
      y = "Number of top 10 ramen varieties",
      x = "Country"
    )

top_country_bar
```

```{r}
top_brand_bar = 
  tidy_ramen %>% 
  drop_na(rank) %>% 
  count(brand) %>% 
  mutate(brand = fct_reorder(brand, n)) %>% 
  ggplot(aes(x = brand, y = n, fill = brand)) +
    geom_col() +
    geom_text(
      aes(label = n),
      nudge_y = 0.125
    ) + 
    labs(
      title = "Number of top 10 ramen varieties produced by each brand",
      y = "Number of top 10 ramen varieties",
      x = "Brand"
    ) +
    theme(axis.text.x = element_text(angle = 30))

top_brand_bar
```

Singapore was the country that had the most top 10 ramen varieties (`r tidy_ramen %>% drop_na(rank) %>% filter(country == "Singapore") %>% nrow()`), while Prima Taste was the brand that had the most top 10 ramen varieties (`r tidy_ramen %>% drop_na(rank) %>% filter(brand == "Prima Taste") %>% nrow()`).

### Exploration by Country
In the Rating by Country page, we performed data analysis on the ramen variety count by country to give us an idea about the top ramen produce countries and created average rating distribution graphs for the top four ramen produce countries. Then, we calculated the average ramen rating scores for each country in our dataset to find the top three and bottom three countries.  

### Exploration by Brand

```{r, include=FALSE, message=FALSE, warning=FALSE}
five_stars =
  tidy_ramen %>%
  select(brand, stars) %>%
  group_by(brand) %>%
  filter(stars == 5)

zero_stars =
  tidy_ramen %>%
  select(brand, stars) %>%
  group_by(brand) %>%
  filter(stars == 0)
```
In the By Brand page, we counted the total number of brands is `r nrow(count(tidy_ramen, brand))`. The number of brands with 5-Stars ramen is `r nrow(count(five_stars, brand))`, and the number of brands with 0-Stars ramen is `r nrow(count(zero_stars, brand))`. 

```{r}
most_various = 
  tidy_ramen %>%
  group_by(brand) %>%
  summarize(num_varieties = n()) %>%
  top_n(5) %>%
  mutate(brand = fct_reorder(brand, num_varieties))

most_various_plot =
  most_various %>%
  mutate(text_label = str_c("Brand: ", brand, "\nNumber of varieties: ", num_varieties)) %>% 
  plot_ly(x = ~brand, y = ~num_varieties, color = ~brand, type = "bar", 
          text = ~text_label,
          marker = list(color = 'viridis', 
                        line = list(color = 'white', width = 1.5))) %>% 
  layout(title = "5 Ramen Brands with Most Rated Varieties",
         xaxis = list(title = "Brand"),
         yaxis = list(title = "Number of Varieties")) 

most_various_plot
```
We grouped data by brands, counted the number of variety for each brand, drew a plot to show the 5 most various brands and their number of variety.

```{r}
distri_various = 
  tidy_ramen %>%
  drop_na(stars) %>%
  filter(brand %in% c("Paldo", "Mama", "Maruchan", "Nongshim", "Nissin")) %>%
  mutate(brand = forcats::fct_relevel(brand, c("Paldo", "Mama", "Maruchan", "Nongshim", "Nissin"))) %>% 
  ggplot(aes(x = brand, y = stars, color = brand)) + 
  geom_boxplot() +
  labs(
    title = "Rating Distribution Plot of the 5 Brands with Most Rated Varieties",
    x = "Brand",
    y = "Rating Stars (0-5)"
  )

distri_various
```
For these 5 brands, we created a boxplot about their rating stars and ordered as the above plot. The median rating stars of *Nissin*, *Nongshim*, and *Paldo* are close to 4 stars. The median of  *Mama* and *Maruchan* are lower than 4 stars. 75% of products of these 5 brands were rated above or equal to 3 Stars.
 
```{r}
five_stars_various = 
  tidy_ramen %>%
  drop_na(stars) %>%
  filter(brand %in% c("Paldo", "Mama", "Maruchan", "Nongshim", "Nissin"),
         stars == 5) %>%
  group_by(brand) %>%
  summarize(num_five = n())

num_five_various = 
  full_join(
    most_various, five_stars_various, by = c("brand")
  ) %>%
  mutate(prct = num_five / num_varieties * 100)

prct_plot = 
  num_five_various %>%
  mutate(brand = fct_reorder(brand, prct)) %>% 
  ggplot(aes(x = brand, y = prct, fill = brand)) + 
  geom_col() +
  geom_text(
    aes(label = round(prct, 2)),
    nudge_y = 0.5
  ) +
  labs(
    title = "Percentage of 5 Stars Ramen among the 5 Brands with Most Rated Varieties",
    x = "Brand",
    y = "Percentage of 5 Stars (%)"
  )

prct_plot
```
Since all 5 brands have 5-Stars ramen products, we calculated the number of 5-Stars ramen and the percentage of 5-Stars for each brand, created a bar chart and ordered by the absolute percentage of 5-Stars ramen.  

### Exploration by Type/Style

## Additional Analysis

## Discussion


